<!-- Simple Analytics core + auto-events must load before custom event code -->
<script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
<script
  async
  data-collect="outbound,emails,downloads"
  data-extensions="pdf,csv,docx,xlsx,zip,doc,xls"
  data-use-title="true"
  data-full-urls="true"
  src="https://scripts.simpleanalyticscdn.com/auto-events.js"></script>
<noscript><img src="https://queue.simpleanalyticscdn.com/noscript.gif" alt="" referrerpolicy="no-referrer-when-downgrade" /></noscript>
<script>
(function() {
  const host = location.hostname;
  if (host === 'localhost' || host === '127.0.0.1') {
    // no-op SA events in local dev
    window.sa_event = function() {};
    console.info('[SA] Events disabled on local dev:', host);
  }
})();
</script>
<script>
// Unified emitter with page context enrichment
(function(){
  function getPageContext(){
    const path = location.pathname;
    let page_type = 'page';
    if (path === '/' || path === '/index.html') page_type = 'home';
    else if (/\/about\/?$/.test(path)) page_type = 'about';
    else if (/\/(cv|resume)\/?$/.test(path)) page_type = 'cv';
    else if (/\/(selected-work|work)\//.test(path)) page_type = 'case_study';
    const slug = path.replace(/\/$/, '').split('/').filter(Boolean).pop() || 'home';
    return { page_type, page_slug: slug, path };
  }
  window.__saPageCtx = getPageContext();

  window.saEmit = function(name, data){
    if (typeof window.sa_event !== 'function') return;
    const payload = Object.assign({}, window.__saPageCtx, data || {});
    try { window.sa_event(name, payload); } catch (_) {}
  };
})();
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const container = document.querySelector('.work-content') || document.querySelector('main');
  if (!container) return;

  const h3s = Array.from(container.querySelectorAll('h3'));
  h3s.forEach((h3) => {
    if (!h3 || h3.closest('details.details-accordion')) return; // skip already processed

    const details = document.createElement('details');
    details.className = 'details-accordion';
    if (h3.id) details.id = h3.id;
    const summary = document.createElement('summary');
    summary.innerHTML = h3.innerHTML; // preserve inline markup
    details.appendChild(summary);

    let n = h3.nextElementSibling;
    let moved = 0;
    while (n && !/^H[23]$/.test(n.tagName)) {
      const next = n.nextElementSibling;
      details.appendChild(n);
      n = next;
      moved++;
    }

    if (!moved) return;

    h3.replaceWith(details);
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Delegated listener for all <details class="details-accordion">
  document.addEventListener('toggle', (e) => {
    const d = e.target;
    if (!(d instanceof HTMLDetailsElement)) return;
    if (!d.classList || !d.classList.contains('details-accordion')) return;

    const all = Array.from(document.querySelectorAll('details.details-accordion'));
    const isLast = all.length ? all[all.length - 1] === d : false;
    const id = d.id || `details-${Math.max(1, all.indexOf(d) + 1)}`;
    const labelEl = d.querySelector('summary');
    const label = labelEl ? (labelEl.textContent || '').trim() : '';

    saEmit(d.open ? 'read_more_open' : 'read_more_close', {
      id,
      is_last: isLast,
      label
    });
  }, { capture: true, passive: true });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const container = document.querySelector('.work-content') || document.querySelector('main') || document.body;
  const selector = container.classList && container.classList.contains('work-content') ? '.work-content' : (container.tagName ? container.tagName.toLowerCase() : 'body');

  function thresholds(){
    const rect = container.getBoundingClientRect();
    const startY = window.scrollY + rect.top;
    const total = Math.max(container.scrollHeight - window.innerHeight, 0);
    return {
      d25: startY + total * 0.25,
      d50: startY + total * 0.50,
      d75: startY + total * 0.75,
      d100: startY + total
    };
  }

  let sent = { d25:false, d50:false, d75:false, d100:false };
  let t = thresholds();
  let ticking = false;

  function emit(depth){ saEmit('scroll_depth', { depth, container: selector }); }

  function check(y){
    if (!sent.d25 && y >= t.d25){ emit(25); sent.d25 = true; }
    if (!sent.d50 && y >= t.d50){ emit(50); sent.d50 = true; }
    if (!sent.d75 && y >= t.d75){ emit(75); sent.d75 = true; }
    if (!sent.d100 && y + 2 >= t.d100){ emit(100); sent.d100 = true; }
  }

  function onScrollOrResize(){
    if (ticking) return;
    ticking = true;
    requestAnimationFrame(() => {
      t = thresholds();
      check(window.scrollY);
      ticking = false;
    });
  }

  window.addEventListener('scroll', onScrollOrResize, { passive: true });
  window.addEventListener('resize', onScrollOrResize, { passive: true });
  check(window.scrollY);
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector('.back-to-top');
  if (!btn) return;
  btn.addEventListener('click', () => { saEmit('back_to_top'); }, { passive: true });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const links = Array.from(document.querySelectorAll('a[href]')).filter(a => {
    const href = a.getAttribute('href');
    if (!href || href.startsWith('#')) return false;
    let url;
    try { url = new URL(href, location.origin); } catch (_) { return false; }
    if (url.origin !== location.origin) return false;
    const isCaseStudy = /\b(selected-work|work)\b/.test(url.pathname);
    return isCaseStudy && url.pathname !== location.pathname;
  });

  links.forEach(a => {
    a.addEventListener('click', () => {
      const url = new URL(a.getAttribute('href'), location.origin);
      saEmit('case_study_nav', { from: location.pathname, to: url.pathname, direction: 'next' });
    }, { passive: true });
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // CV link clicks
  document.querySelectorAll("a[href*='/cv']").forEach(a => {
    a.addEventListener('click', () => { saEmit('cv_visit_click', { placement: a.closest('header, footer, nav') ? 'chrome' : 'body' }); }, { passive: true });
  });
  // Contact clicks
  document.querySelectorAll("a[href^='mailto:'], a[href^='tel:']").forEach(a => {
    a.addEventListener('click', () => {
      const href = a.getAttribute('href') || '';
      const type = href.startsWith('mailto:') ? 'email' : 'tel';
      saEmit('contact_click', { type, label: (a.textContent || '').trim() });
    }, { passive: true });
  });
  // Landing tags from query params (e.g., utm_source, ref)
  try {
    const u = new URL(location.href);
    const src = u.searchParams.get('utm_source') || u.searchParams.get('ref') || '';
    if (src) saEmit('landing_tag', { source: src });
  } catch (_) {}
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  document.body.classList.add("visible");
});
</script>